<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Météo Europe</title>
  <link rel="stylesheet" href="/css/style.css">
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      
      //display the local time
      function updateTime() {
        document.getElementById('localtime').innerHTML = new Date().toLocaleString();
      }
      updateTime();
      setInterval(updateTime, 1000);

      // the fetch API
      fetch('/api/cities')
        .then(response => response.json())
        .then(data => {
          const dropdown = document.getElementById('city-dropdown');
          dropdown.innerHTML = '';
          data.forEach(pair => {
            const option = document.createElement('option');
            option.value = `${pair.latitude}, ${pair.longitude}`;
            option.textContent = `${pair.city}, ${pair.country}`;
            dropdown.appendChild(option);
          });

          dropdown.addEventListener('change', (event) => {
            const [ longitude, latitude ] = event.target.value.split(',');
            fetch(`/api/data?longitude=${longitude}&latitude=${latitude}`)
            .then(response => response.json())
            .then(apiData => {
              console.log(apiData);
                const resultContainer = document.getElementById('forecast-block');
                resultContainer.innerHTML = ''; // Clear previous results

                // Create a list to display the data
                const ul = document.createElement('dablock');
                apiData.forEach((item, index) => {
                  const li = document.createElement('card');
                  li.textContent = `Item ${index + 1}: Weather - ${item.weather}, Temperature - ${item.temp2m}°C`;
                  ul.appendChild(li);
                });
                resultContainer.appendChild(ul);
            })
            .catch(error => console.error('Error fetching API data', error));
          });
        })
        .catch(error => console.error('Error fetching city data:', error));
    });
  </script>
</head>
<body>
  <h1>Météo Europe</h1>
  <h2>Prévisions de la semaine</h2>
  <label for="city-dropdown"> Choisissez une ville...</label>
  <select id="city-dropdown">
    <!-- Options will be populated here -->
  </select>
      
  <!--the forecast which shall be shown 7 times-->
      <p></p>
      <div id="get-results-heading" class="section-subheading"></div>
      <div id="result-container" class="result-container">
          <div id="forecast-block" class="forecast-block">

              <div class="dablock">
                  <div class="card">
                      <p class="weather-date">Thu Jul 25</p>
                      <div class="weather-icon-div">
                          <img class="weather-icon" src="../images/pcloudy.png">
                      </div>
                      <div class="card-body">
                          <p class="weather-description">PARTLY CLOUDY</p>
                          <p class="weather-temperatures">H: 20C</p>
                          <p class="weather-temperatures">L: 10C</p>
                      </div>
                  </div>
              </div>

          </div>
      </div>
    <footer>
      <div class="section-divider">
        <img src="../images/cloudline.png">
      </div>
      <p></p>
        <code class="copyright-text">Copyright 2024 the conventionals</code>
        <div id="localtime"></div>
    </footer>
</body>
</html>
